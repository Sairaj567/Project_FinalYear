<%- include('../partials/header') %>

<div class="dashboard-container">
  <%- include('../partials/admin-nav') %>
  
  <div class="main-content">
    
    <div class="content-header">
      <h1>Student Details</h1>
      <a href="/admin/students" class="btn btn-secondary">Back to Student List</a>
    </div>

    <div class="card profile-preview-container">
      <header class="preview-header">
        <h1><%= profile.personal.firstName %> <%= profile.personal.lastName %></h1>
        <div class="contact-info">
          <span><%= profile.user.email %></span> |
          <span><%= profile.personal.contactNumber %></span> |
          <span><a href="<%= profile.personal.linkedIn %>" target="_blank">LinkedIn</a></span> |
          <span><a href="<%= profile.personal.github %>" target="_blank">GitHub</a></span>
        </div>
      </header>

      <section class="preview-section">
        <h3>Personal Information</h3>
        <div class="preview-grid">
          <div class="preview-item"><p><strong>Full Name:</strong> <%= profile.personal.firstName %> <%= profile.personal.middleName %> <%= profile.personal.lastName %></p></div>
          <div class="preview-item"><p><strong>Age:</strong> <%= profile.personal.age %></p></div>
          <div class="preview-item"><p><strong>DOB:</strong> <%= profile.personal.dob ? new Date(profile.personal.dob).toLocaleDateString() : '' %></p></div>
        </div>
      </section>

      <section class="preview-section">
        <h3>Educational Background</h3>
        <div class="preview-grid">
          <div class="preview-item"><p><strong>10th %:</strong> <%= profile.education.tenthPercentage %>%</p></div>
          <div class="preview-item"><p><strong>12th %:</strong> <%= profile.education.twelfthPercentage %>%</p></div>
          <div class="preview-item"><p><strong>Diploma %:</strong> <%= profile.education.diplomaPercentage %>%</p></div>
        </div>
        <div class="preview-grid" style="margin-top: 10px;">
            <div class="preview-item"><p><strong>Degree:</strong> <%= profile.currentCourse.degree %></p></div>
            <div class="preview-item"><p><strong>Branch:</strong> <%= profile.currentCourse.branch %></p></div>
            <div class="preview-item"><p><strong>Graduation Year:</strong> <%= profile.currentCourse.graduationYear %></p></div>
            <div class="preview-item"><p><strong>Aggregate:</strong> <%= profile.currentCourse.aggregatePercentage %>%</p></div>
        </div>
      </section>

      <section class="preview-section">
        <h3>Skills</h3>
        <p><strong>Technical Skills:</strong></p>
        <ul class="preview-list job-tags">
          <% profile.skills.technical.forEach(skill => { %>
            <li class="job-tag"><%= skill %></li>
          <% }) %>
        </ul>
        <p style="margin-top: 10px;"><strong>Soft Skills:</strong></p>
        <ul class="preview-list job-tags">
          <% profile.skills.soft.forEach(skill => { %>
            <li class="job-tag"><%= skill %></li>
          <% }) %>
        </ul>
      </section>

      <section class="preview-section">
        <h3>Projects</h3>
        <% profile.projects.forEach(project => { %>
          <div class="work-item">
            <h4><%= project.title %> <% if (project.url) { %> - <a href="<%= project.url %>" target="_blank">Link</a><% } %></h4>
            <p><%= project.description %></p>
          </div>
        <% }) %>
      </section>

      <section class="preview-section">
        <h3>Work Experience</h3>
        <% profile.workExperience.forEach(exp => { %>
          <div class="work-item">
            <h4><%= exp.role %> at <%= exp.company %></h4>
            <% if (exp.lorUrl) { %>
              <p><a href="<%= exp.lorUrl %>" class="btn btn-secondary btn-sm" target="_blank">View LOR/Certificate</a></p>
            <% } %>
          </div>
        <% }) %>
      </section>
    </div>

    <div class="card" style="margin-top: 30px;">
        <h3>Application History</h3>
        <table class="data-table">
            <thead>
                <tr>
                    <th>Company</th>
                    <th>Role</th>
                    <th>CTC</th>
                    <th>Applied On</th>
                    <th>Resume</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <% if (applications.length === 0) { %>
                    <tr>
                        <td colspan="6" style="text-align: center;">This student has not applied to any jobs yet.</td>
                    </tr>
                <% } %>
                <% applications.forEach(app => { %>
                    <tr>
                        <td><%= app.job.company %></td>
                        <td><a href="/admin/jobs/<%= app.job._id %>/manage"><%= app.job.title %></a></td>
                        <td><%= app.job.ctc %></td>
                        <td><%= new Date(app.createdAt).toLocaleDateString() %></td>
                        <td><a href="<%= app.appliedResumeUrl %>" class="btn btn-secondary" target="_blank">View</a></td>
                        <td><span class="status status-<%= app.status %>"><%= app.status %></span></td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    </div>

  </div>
</div>

<%- include('../partials/footer') %>
